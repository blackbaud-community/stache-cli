#!/usr/bin/env node

/**
* Why such a small file?  In almost all cases, this is simply a shim for grunt.
* We kept grunt in order to better support TFS / Visual Studio development (surprising right?)
**/

'use strict';

// Libraries
var fs = require('fs');
var path = require('path');
var shell = require('child_process').exec;
var cli = path.normalize(__dirname + '/../');
var cwd = path.normalize(process.cwd() + '/');

var gruntconfig = 'gruntfile.js';
var isLocal = fs.existsSync(cwd + gruntconfig);
var gruntfile = (isLocal ? cwd : cli) + gruntconfig;

// Configuration
var options = { cwd: cwd };
var args = [
  'grunt',
  process.argv.slice(2).join(':'),
  '--cli=' + cli,
  '--cwd=' + cwd,
  '--gruntfile=' + gruntfile,
  '--base=' + (isLocal ? cwd : cli)
];

// Verify user ran npm install (if we're running locally)
if (isLocal) {
  if (!fs.existsSync(cwd + 'node_modules')) {
    console.error('You must run "npm install" before using Blackbaud Stache.');
  }
}

// Execution
var grunt = shell(args.join(' '), options);
var output = function (data) {
 process.stdout.write(data);
};

// Event Listening
grunt.stdout.on('data', output);
grunt.stderr.on('data', output);
grunt.on('error', output);